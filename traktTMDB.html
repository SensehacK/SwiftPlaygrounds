<!DOCTYPE html>
<html>
<body>

<div id="beta"></div>

<img id="output1"> <p id "movieTitle1"> </p> <p id "movieYear1"> </p> 
<img id="output2"> <p id "movieTitle2"> </p> <p id "movieYear2"> </p> 
<img id="output3"> <p id "movieTitle3"> </p> <p id "movieYear3"> </p> 
<img id="output4"> <p id "movieTitle4"> </p> <p id "movieYear4"> </p> 
<img id="output5"> <p id "movieTitle5"> </p> <p id "movieYear5"> </p> 
<img id="output6"> <p id "movieTitle6"> </p> <p id "movieYear6"> </p> 
<img id="output7"> <p id "movieTitle7"> </p> <p id "movieYear7"> </p> 
<img id="output8"> <p id "movieTitle8"> </p> <p id "movieYear8"> </p> 
    <!-- output will go here -->
</div>
<script>

var movieImgsPath = []
var movieIDsPath = []
var outputStrNo = 1;
// var movieTitleStrNo = 1;
// var movieYearStrNo = 1;

function movieTrakt() {
          var request = new XMLHttpRequest();

          var getRecentShowsHistory = "https://api.trakt.tv/users/sensehack/history/shows/"

          var getRecentMoviesHistory = "https://api.trakt.tv/users/sensehack/history/movies/"

          // call url
          request.open('GET', getRecentMoviesHistory);


          request.setRequestHeader('Content-Type', 'application/json');
          request.setRequestHeader('trakt-api-version', '2');

          // Client ID of Trial 2 cors.io
          request.setRequestHeader('trakt-api-key', 'e76f84733301c6380989637d3c7cc0394f58ae5046b94649d9d65f18e31e43fa');

          
          request.onreadystatechange = function () {

            if (this.readyState === 4) {
              console.log('Status:', this.status);
              console.log('Headers:', this.getAllResponseHeaders());
              console.log('Body:', this.responseText);


              //Converting responseText String JSON to Javascript Object JSON.
              var traktJSON = this.responseText;
              var movieIDTr = ""
              var traktObj = JSON.parse(traktJSON)

              
              //Accessing 8 json elements overall
              for (var i = 0; i < 8; i++) {
                    console.log("Printing iteration number", i) 

                    // Trying to access movie titles & year details  
                    console.log("traktObj[i].id")
                    console.log(traktObj[i].id)
                    
                    // Accessing movie title
                    var movieTitle = traktObj[i].movie.title
                    console.log("accessing movie title")
                    console.log(movieTitle)

                    // Accessing movie title
                    var movieYear = traktObj[i].movie.year
                    console.log("accessing movie year")
                    console.log(movieYear)

                    // Accessing movie title
                    console.log("accessing .traktObj[i].movie.id.tmdb")
                    var movieTmdbId = traktObj[i].movie.ids.tmdb
                    console.log(movieTmdbId) 
                    movieIDTr = movieTmdbId
                    
                    // Storing movie ID's in array
                    movieIDsPath.push(movieIDTr)

                    // Calling the function with user Movie ID
                    UserAction(movieIDTr,movieTitle,movieYear)
              }
              
              console.log("movieIDsPathMediaStreamTrackEvent")
              console.log(movieIDsPath)

            }

          };

          request.send();

}

function UserAction(movieIDT) {

    // Variables 
    var urlTMDB = "https://api.themoviedb.org/3/movie/"
    var movieID = movieIDT;
    var apiKeyTMDB = "?api_key=eab66c078f08232f3a3dec068c6a14d3";
    var langTMDB = "&language=en-US";
    var fullUrlTMDB = "https://api.themoviedb.org/3/movie/100402?api_key=eab66c078f08232f3a3dec068c6a14d3&language=en-US";


    var concatTmdbMovieURL = urlTMDB + movieID + apiKeyTMDB + langTMDB
    console.log("concatTmdbMovieURL urlTMDB + movieID + apiKeyTMDB + langTMDB")
    console.log(concatTmdbMovieURL)
    console.log("movieIDT")
    console.log(movieIDT)
    
// Last FM API Integration Testing
fetch(concatTmdbMovieURL)
    .then(function(response) {
    return response.json();
        })
        .then(function(jsonResponse) {

            console.log(jsonResponse)
            console.log("type of jsonresponse")
            console.log(typeof(jsonResponse))
            

            var poster = jsonResponse.poster_path
            console.log("printing jsonResponse.poster_path")
            console.log(jsonResponse.poster_path)
            var imageTMDB = "http://image.tmdb.org/t/p/w342/"
            var fullImageTMDB = imageTMDB + poster
            console.log("fullImageTMDB imageTMDB + poster")
            console.log(fullImageTMDB)
            
            //Adding image paths to the array
            movieImgsPath.push(fullImageTMDB)

            //Calling individual function image paths urls from TMDB
            singleImageDisplay(fullImageTMDB)
            


    })

}

function imageDisplay() {
    // Displaying 8 last watch movies images
    for (i = 0; i < 8; i++) {
        var outputStr = "output"
        outputStr = outputStr + (i + 1)
        console.log(outputStr)
        console.log(outputStr)
        console.log("movieImgsPath[i]")
        console.log(movieImgsPath[i])
        document.getElementById(outputStr).src = movieImgsPath[i];
    }
    imagesNotDisplayed = false;

}


function singleImageDisplay(imgPath) {
    var outputStr = "output"
    var movieTitleStr = "movieTitle"
    var movieYearStr = "movieYear"
    // Displaying 8 last watch movies images
        console.log("imageDisplay2(imgPath")
        console.log(imgPath)
        var outputStr = "output"
        console.log(outputStr)
        outputStr = outputStr + outputStrNo;
        movieTitleStr = movieTitleStr + outputStrNo
        movieYearStr = movieYearStr + outputStrNo
        console.log("outputStr = outputStr + outputStrNo;")
        console.log(outputStr)
        document.getElementById(outputStr).src = imgPath ;
        document.getElementById(outputStr).src = imgPath ;
        document.getElementById(outputStr).src = imgPath ;
        console.log("outputStrNo")
        console.log(outputStrNo)
        // Incrementing the html tag ID string value
        outputStrNo = (outputStrNo + 1)
    }

</script>

<button type="submit" onclick="movieTrakt()">Search</button>
<button type="submit" onclick="imageDisplay()">Images</button>  

</body>
</html>
